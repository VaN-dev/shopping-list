{% extends ':default:layout.html.twig' %}


{% block content %}
    <div class="container-fluid">
        {% include "ComurImageBundle:Form:croppable_image_modal.html.twig" with {'include_jquery': false, 'include_bootstrap': false} %}

        <h1>Ajouter une recette</h1>

        <div class="row">
            <div class="col-xs-12">

                <form method="POST">
                    {{ form_row(form.name) }}
                    {{ form_row(form.people, {'attr': {'class': 'touchspin'}}) }}
                    {{ form_row(form.scope) }}
                    {{ form_row(form.image) }}

                    <h3>Ingredients</h3>
                    <div class="ingredients" data-prototype="{% filter escape %}{{ include('@App/Recipe/ingredient-prototype.html.twig', { 'ingredient': form.ingredients.vars.prototype }) }}{% endfilter %}">
                        {% for ingredient in form.ingredients %}
                            {{ include('@App/Recipe/ingredient-prototype.html.twig', { 'ingredient': ingredient }) }}
                        {% endfor %}
                    </div>

                    <a href="#" id="add-ingredient-trigger">Ajouter un ingrédient</a>

                    <hr />

                    <input type="submit" value="Valider" class="btn btn-primary">
                    {{ form_rest(form) }}
                </form>

            </div>
        </div>
    </div>

{% endblock content %}

{% block javascripts %}
    <script type="text/javascript">
        function init() {
            initIngredientAutocomplete();
            initTouchSpin();
        }

        $(function(e) {
            // Récupère le div qui contient la collection d'ingredients
            var collectionHolder = $('div.ingredients');

            $(document).on('click', '#add-ingredient-trigger', function(e) {
                e.preventDefault();
                addIngredientForm(collectionHolder);
                initTouchSpin();
            });

            $(document).on('click', '.delete-ingredient-trigger', function(e) {
                e.preventDefault();
                $(this).parents('fieldset').remove();
            });

            init();
        });
    </script>
{% endblock javascripts %}